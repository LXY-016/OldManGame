# 关卡选择界面需求文档 (PRD)
文档版本: V1.0 | 对应模块: 关卡选择/进度管理 (Level Select)
前置界面: [启动/主界面] | 后置界面: [游戏关卡主界面]


## 1. 界面整体概述 (Overview)
此界面用于展示游戏的所有关卡节点，采用**左右滑动的卷轴地图**形式。并根据玩家的存档记录显示当前的通关进度。玩家在此处选择想要挑战的关卡。

## 1.1. 技术实现方案 (Technical Implementation)
*   **混合架构 (Hybrid)**:
    *   **渲染层 (Canvas Layer)**: Three.js 渲染长卷地图背景。
        *   *Camera*: 使用 OrthographicCamera，仅允许 X 轴平移。
        *   *Scroll Logic*: 监听 `pointermove` 计算 `deltaX`，反向移动摄像机实现拖拽感。
    *   **UI层 (DOM Layer)**: 
        *   **关卡节点**: 建议使用 `CSS2DObject` 或绝对定位的 DOM 元素跟随 3D 坐标，以便轻松实现复杂的 CSS 动画（呼吸/锁图标）。
        *   **固定 UI**: 返回按钮、标题栏固定在屏幕上方。

## 2. 详细功能需求 (Functional Specifications)

### 2.1. 界面初始化与进度读取 (Initialization & Save Data)
- **核心逻辑**:
    - **读取存档**: 加载时读取本地/云端存档，获取最高通关记录。
    - **关卡状态**:
        1.  **[未解锁] (Locked)**: 玩家尚未达到进入条件。
        2.  **[当前/已解锁] (Unlocked)**: 已满足条件但尚未通过。
        3.  **[已通关] (Cleared)**: 已经成功通过的关卡。

### 2.2. 关卡解锁规则 (Unlock Progression)
- **初始状态**: 仅第 1 关默认解锁。
- **线性解锁**: 完成第 N 关 (达到最低服务人数目标) -> 解锁第 N+1 关。
- **不可跳关**: 必须按顺序依次挑战。

### 2.3. 关卡节点交互 (Level Node Interaction)
- **数量规则**: MVP 版本共 **10个关卡**。
- **状态行为定义**:
    1.  **[未解锁] (Locked)**:
        - **视觉**: 灰色/黑影，上有锁图标。详见 `Art Assets.md` [Section 2.3]。
        - **点击行为**: 节点轻微晃动，播放“禁止”音效。
        - **UI反馈**: 弹出提示气泡 "请先通关上一层"。
    2.  **[当前/已解锁] (Unlocked)**:
        - **视觉**: 正常彩打，带有呼吸/跳动动画 (强调当前进度)。详见 `Art Assets.md` [Section 2.3]。
        - **点击行为**: 播放“选中”音效，节点缩放。
        - **UI反馈**: 直接进入游戏加载 (Layer 1)。
    3.  **[已通关] (Cleared)**:
        - **视觉**: 亮色彩打，显示“通关标记”或“最高服务人数”。详见 `Art Assets.md` [Section 2.3]。
        - **点击行为**: 同 [已解锁]。
        - **UI反馈**: 进入游戏 (Replay Mode)，允许刷新记录。

### 2.4. 通用 UI 组件 (Common UI)
- **返回按钮 (Back Button)**:
    - **位置**: 左上角常驻。
    - **交互**:
        - **点击**: 触发场景切换，卸载当前资源。
        - **目标**: 返回至 [Layer 0 启动/主界面]。
        - **反馈**: 播放标准按钮音效 (详见`Art Assets.md` [Section 5.0])。

## 3. 界面美术与布局建议 (Visual & Layout)
> 详细视觉风格与状态反馈请参考: [Art Assets.md](Art%20Assets.md) - Section 2.3

- **表现形式**: **“社区长卷地图”** (横向卷轴)。
    - **背景**: 连续的社区街道插画。
    - **节点**: 沿街道分布的建筑或地标。
- **交互方式**:
    - 支持 **鼠标拖拽 / 触摸滑动** 进行横向卷轴查看 (Horizontal Scroll)。
    - **自动聚焦**: 进入界面时，摄像机自动平滑移动到[当前解锁]的最新关卡位置。
- **状态区分**: 需清晰区分[已解锁]、[未解锁]与[已通关]三种状态。

## 4. 流程图示 (Flowchart)
```mermaid
graph TD
    %% 阶段一: 初始化
    A[启动界面: 点击开始] --> B(进入选关界面 Layer 2)
    B --> C{读取玩家存档}
    C --> D[渲染横向卷轴地图]
    D --> D1[镜头自动聚焦: 最新进度节点]
    
    %% 阶段二: 玩家操作循环
    D1 --> E{玩家交互操作}
    
    E -- 点击 [返回按钮] --> F[回到主菜单 (Layer 0)]
    
    E -- 拖拽/滑动地图 --> G[浏览其他关卡]
    
    E -- 点击 [关卡节点] --> H{系统判定节点状态}
    
    %% 阶段三: 判定结果
    H -- [未解锁] --> I[拒绝: 抖动 + 锁图标提示]
    H -- [已解锁] --> J[通过: 进入游戏 (Layer 1)]
    H -- [已通关] --> K[允许: 进入游戏 (重玩模式)]
```
